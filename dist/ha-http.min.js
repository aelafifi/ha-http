"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(){var e=angular.module("ha.http",[]);try{angular.module("ngFileUpload"),e.requires.push("ngFileUpload"),e.canUpload=!0}catch(t){e.canUpload=!1}}(),function(){angular.module("ha.http").provider("$eventGroup",function(){this.get=function(){return new t},this.$get=function(){return function(){return new t}}});var t=function(){function e(){_classCallCheck(this,e),this.eventGroups={}}return _createClass(e,[{key:"on",value:function(t,e,n){var r=this,s=[];if("object"!==(void 0===e?"undefined":_typeof(e))||Array.isArray(e))if(Array.isArray(e))for(var o=0;o<e.length;o++)s.push([n,e[o]]);else s.push([n,e]);else for(var u in e){var i=e[u];if(Array.isArray(i))for(var a=0;a<i.length;a++)s.push([u,i[a]]);else s.push([u,i])}this.eventGroups[t]||(this.eventGroups[t]=[]);for(var l=0;l<s.length;l++)this.eventGroups[t].push({priority:s[l][0]||0,callback:s[l][1]});return function(){return r.off(t,s)}}},{key:"off",value:function(t,e){if(void 0!==e){if(this.eventGroups[t])for(var n=this.eventGroups[t],r=0;r<n.length;)Array.isArray(e)&&~e.indexOf(n[r])||n[r]===e?n.splice(r,1):r++}else this.eventGroups[t]=[]}},{key:"emit",value:function(t){Array.isArray(t)||(t=[t]);for(var e=!1,n=!1,r={preventGroup:function(){return e=!0},preventAll:function(){return n=!0}},s=arguments.length,o=Array(1<s?s-1:0),u=1;u<s;u++)o[u-1]=arguments[u];for(var i=0;i<t.length;i++){var a=this.eventGroups[t[i]];if(a){a.sort(function(t,e){return t.priority-e.priority});for(var l=0;l<a.length;l++){var c;if((c=a[l].callback).call.apply(c,[r].concat(o)),e||n){e=!1;break}}if(n)break}}}},{key:"copy",value:function(){var t=new e;return angular.copy(this,t),t}},{key:"clone",value:function(){return this.copy()}}]),e}()}(),angular.module("ha.http").service("HttpApiRequest",function(){var r=function(){function s(t,e,n){var r=this;_classCallCheck(this,s),this.state="loading",this.response=null,this.progress=null,this.holder=t,this.inBg=!1,this.simulateAbort=!1,n.url=new URL(n.url,n.baseUrl||location.href).href,this.httpRequest=e(n),this.httpRequest.then(function(t){r.progress=null,r.response=t,r.state="done",r.callCallbacks(n,t,[t.status,parseInt(t.status/100),"resolve","after"])},function(t){return r.progress=null,"abort"===(r.response=t).xhrStatus?(r.state="aborted",r.callCallbacks(n,t,[t.status,parseInt(t.status/100),"abort","after"])):(r.state="failed",r.callCallbacks(n,t,[t.status,parseInt(t.status/100),"reject","after"]))},function(t){r.progress=parseInt(1e4*t.loaded/t.total)/100})}return _createClass(s,[{key:"abort",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return"function"!=typeof this.httpRequest.abort?t||console.error("This request can't be aborted"):this.httpRequest.abort()}},{key:"callCallbacks",value:function(t,e,n){if(!(this.inBg&&!t.listenBg||this.simulateAbort)){for(var r=this.holder.events,s=0;s<n.length;s++)this.holder.options[n[s]]&&r.on(n[s],this.holder.options[n[s]],50),t[n[s]]&&r.on(n[s],t[n[s]],50);r.emit(n,e.data,e.status,e.statusText)}}},{key:"registerInBg",value:function(){this.inBg=!0}}]),s}();return function(t,e,n){return new r(t,e,n)}}),function(){function t(s,t){var o={consurrent:!1,baseUrl:location.href,data:{},listenBg:!0};this.setDefaults=function(t){return angular.extend(o,t)};var u=t.get();function e(r,n){var e=function(){function e(t){_classCallCheck(this,e),"string"==typeof t&&(t={url:t}),this.options=t,this.$$request=null}return _createClass(e,[{key:"getOptions",value:function(){for(var t,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=angular).extend.apply(t,[{},o,this.options].concat(n))}},{key:"get",value:function(t){return this.$$httpRequest({},t,"GET")}},{key:"post",value:function(t,e){return this.$$httpRequest(t,e,"POST")}},{key:"put",value:function(t,e){return this.$$httpRequest(t,e,"PUT")}},{key:"delete",value:function(t){return this.$$httpRequest({},t,"DELETE")}},{key:"upload",value:function(t,e){if("function"==typeof t&&(t=t()),e=this.getOptions(e,{data:t}),!s.has("Upload"))throw new Error("`ng-file-upload` dependency required!");return this.realSend(s.get("Upload").upload,e)}},{key:"$$httpRequest",value:function(t,e,n){return"function"==typeof t&&(t=t()),e=this.getOptions(e,{data:t,method:n}),this.realSend(r,e)}},{key:"realSend",value:function(t,e){if(this.loading){if(!1===e.concurrent)return console.error("Can't send another request while there is another one pending"),this;"abort"===e.concurrent&&this.abort()}return"function"==typeof e.url&&(e.url=e.url()),this.$$request&&this.$$request.registerInBg(),this.$$request=n(this,t,e),this}},{key:"abort",value:function(){return this.$$request&&"loading"==this.$$request.state?this.$$request.abort():console.error("No pending request to abort")}},{key:"copy",value:function(){var t=new e({});return angular.copy(this,t),t}},{key:"clone",value:function(){return this.copy()}},{key:"events",get:function(){return u.copy()}},{key:"state",get:function(){return this.$$request&&this.$$request.state}},{key:"loading",get:function(){return"loading"==this.state}},{key:"done",get:function(){return"done"==this.state}},{key:"failed",get:function(){return"failed"==this.state}},{key:"aborted",get:function(){return"aborted"==this.state}},{key:"sent",get:function(){return!!this.$$request}},{key:"response",get:function(){return this.$$request&&this.$$request.response}},{key:"data",get:function(){return this.response&&this.response.data}},{key:"status",get:function(){return this.response&&this.response.status}},{key:"statusText",get:function(){return this.response&&this.response.statusText}},{key:"progress",get:function(){return this.$$request&&this.$$request.progress}}]),e}();return function(t){return new e(t)}}this.on=u.on.bind(u),this.off=u.off.bind(u),(this.$get=e).$inject=["$http","HttpApiRequest"]}angular.module("ha.http").provider("$httpApi",t),t.$inject=["$injector","$eventGroupProvider"]}();